FROM golang:1.22.2-alpine as builder
WORKDIR /webapp
COPY go.mod .
RUN go mod download
COPY . .
RUN CGO_ENABLED=0 go build -o /bin/webapp cmd/main.go

FROM builder AS test
RUN go test -v ./...

FROM ubuntu:24.04
RUN ["apt-get", "update"]
RUN ["apt-get", "install", "ca-certificates", "-y"]
COPY --from=builder /bin/webapp /bin/webapp
ENTRYPOINT ["/bin/webapp"]
