pipeline {
    agent any
    stages {
        stage('lint commit messages') {
            tools {
                nodejs "nodejs"
            }
            steps{
                sh '''
                    export CHANGE_TARGET_COMMIT_ID=$(git rev-parse origin/$CHANGE_TARGET)
                    npx commitlint \
                        -x @commitlint/config-conventional \
                        -f $CHANGE_TARGET_COMMIT_ID
                '''
            }
        }

        stage('webapp build') {
            tools {
                go "go"
            }
            steps {
                sh '''
                    go build -o webapp cmd/main.go
                '''
            }
        }
    }
}
