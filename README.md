# CSYE7125 CVE Processor webapp

This repository contains the code for the CVE Processor webapp. The application fetches the latest CVE data from the NVD database and inserts it into the database.

## Prerequisites

To build and deploy the application locally, you will need the following:

- [Go](https://golang.org/doc/install) (version 1.22 or later)
- [Docker](https://docs.docker.com/get-docker/)
- [PostgreSQL](https://www.postgresql.org/download/) (version 15 or later)
- [Flyway](https://flywaydb.org/getstarted/how)

## Build and Deploy Instructions

### Database Migrations

The database migration are managed using Flyway. To run the migrations, execute the following command:

```bash
flyway -url=jdbc:postgresql://localhost:5432/cve_processor -user=postgres -password=postgres -locations=filesystem:./flyway/sql migrate
```

This can also be done by building the Docker image and running the container:

```bash
docker build -t db-migration ./flyway

# Make sure to update connection string, user & password
docker run \
  --network host \
  -e FLYWAY_URL=jdbc:postgresql://localhost:5432/cve_processor \
  -e FLYWAY_USER=postgres \
  -e FLYWAY_PASSWORD=postgres \
  db-migration migrate
```

### Build and Run the Application

To build the application, execute the following command:

```bash
go build -o cve-processor cmd/main.go
```

To run the application, execute the following command:

```bash
./cve-processor
```

### Application Details

The application will:

- Download the CVE list and process all JSON files in all directories.
- Store the CVEs in a PostgreSQL database using the JSON data type along with some metadata.
- Implement proper indexes on the JSON data type column.
- Support versioning of CVEs to handle updates after initial publication.
- Handle duplicate records.

### Database Schema

- The provided database (`cve`) is created with a schema named `cve`.
- The migration script also creates the `cve` table with the following columns:
  - `cve_id` (VARCHAR) - The CVE ID.
  - `date_updated` (TIMESTAMP) - The timestamp when the record was last updated.
  - `data` (JSONB) - The JSON data for the CVE.
  - `created_at` (TIMESTAMP) - The timestamp when the record was created.
- The cve table also has proper indexes on the `cve_id` and `date_updated` columns.

